const translations = {
    en: {
        nav_shop: "Shop",
        nav_collections: "Collections",
        nav_philosophy: "Philosophy",
        nav_about: "About",
        hero_new: "New Collection 2026",
        hero_title: "Beauty In Simplicity",
        hero_desc: "Experience the pure essence of nature with our dermatologically tested, organic skincare routine. Crafted for every skin type.",
        hero_cta: "Shop Now",
        hero_story: "Our Story",
        hero_feat1: "Natural Ingredients",
        hero_feat2: "Cruelty Free",
        hero_feat3: "Deep Hydration",
        shop_title: "Best Sellers",
        shop_subtitle: "Our Shop",
        shop_all: "All",
        shop_face: "Face",
        shop_body: "Body",
        product_add: "Quick Add",
        footer_desc: "We believe in the power of nature and the beauty of simplicity.",
        footer_discover: "Discover",
        footer_support: "Support",
        cart_title: "Shopping Cart",
        cart_total: "Total:",
        cart_checkout: "Checkout",
        auth_register_title: "Create Account",
        auth_register_subtitle: "Enter your details to get started",
        auth_login_title: "Welcome Back",
        auth_login_subtitle: "Login to your account",
        auth_name: "Full Name",
        auth_email: "Email Address",
        auth_password: "Password",
        auth_register_btn: "Register",
        auth_login_btn: "Login",
        auth_have_account: "Already have an account? ",
        auth_no_account: "Don't have an account? ",
        auth_login_link: "Login",
        auth_register_link: "Register",
        checkout_title: "Shipping Details",
        checkout_phone: "Phone Number",
        checkout_location: "Delivery Address",
        checkout_confirm_btn: "Confirm Order",
        order_summary: "Order Summary",
        subtotal: "Subtotal",
        delivery_fee: "Delivery Fee",
        total: "Total",
        delivery_notice: "Delivery price is fixed for all orders.",
        events_subtitle: "Upcoming Events",
        events_title: "Experience Our World",
        event1_title: "Skincare Masterclass",
        event1_desc: "Learn the secrets of a perfect routine from our experts.",
        event2_title: "Paris Collection Launch",
        event2_desc: "Be the first to try our new organic line.",
        test1_content: "\"My skin has never looked so radiant. These products are a game changer.\"",
        test2_content: "\"Finally, organic skincare that actually delivers results. Highly recommend!\"",
        test3_content: "\"The hydration is incredible. My face feels soft and fresh all day long.\"",
        contact_title: "Get In Touch",
        contact_subtitle: "We'd love to hear from you. Send us a message.",
        order_success_title: "Thank you for your order!",
        order_success_desc: "Your order has been received and is being processed. We will contact you shortly.",
        order_back_home: "Back to Home"
    },
    uz: {
        nav_shop: "Do'kon",
        nav_collections: "To'plamlar",
        nav_philosophy: "Falsafamiz",
        nav_about: "Haqimizda",
        hero_new: "Yangi To'plam 2026",
        hero_title: "Go'zallik Soddalikda",
        hero_desc: "Tabiatning sof mohiyatini bizning dermatologik sinovdan o'tgan, organik terini parvarish qilish tartibimiz bilan his qiling.",
        hero_cta: "Sotib olish",
        hero_story: "Biz haqimizda",
        hero_feat1: "Tabiiy ingredientlar",
        hero_feat2: "Sinovlarsiz (Cruelty Free)",
        hero_feat3: "Chuqur namlantirish",
        shop_title: "Eng xaridorgir",
        shop_subtitle: "Bizning do'kon",
        shop_all: "Hammasi",
        shop_face: "Yuz uchun",
        shop_body: "Beden uchun",
        product_add: "Savatga",
        footer_desc: "Biz tabiat kuchiga va soddalik go'zalligiga ishonamiz.",
        footer_discover: "Kashf qiling",
        footer_support: "Yordam",
        cart_title: "Savat",
        cart_total: "Jami:",
        cart_checkout: "Buyurtma berish",
        auth_register_title: "Ro'yxatdan o'tish",
        auth_register_subtitle: "Ma'lumotlaringizni kiriting",
        auth_login_title: "Xush kelibsiz",
        auth_login_subtitle: "Hisobingizga kiring",
        auth_name: "To'liq ismingiz",
        auth_email: "Email manzilingiz",
        auth_password: "Parol",
        auth_register_btn: "Ro'yxatdan o'tish",
        auth_login_btn: "Kirish",
        auth_have_account: "Hisobingiz bormi? ",
        auth_no_account: "Hisobingiz yo'qmi? ",
        auth_login_link: "Kirish",
        auth_register_link: "Ro'yxatdan o'tish",
        checkout_title: "Yetkazib berish ma'lumotlari",
        checkout_phone: "Telefon raqami",
        checkout_location: "Yetkazib berish manzili",
        checkout_confirm_btn: "Buyurtmani tasdiqlash",
        order_summary: "Buyurtma hisobi",
        subtotal: "Mahsulotlar",
        delivery_fee: "Yetkazib berish",
        total: "Jami",
        delivery_notice: "Yetkazib berish narxi barcha buyurtmalar uchun o'zgarmas.",
        events_subtitle: "Yaqindagi tadbirlar",
        events_title: "Bizning dunyomizni kashf eting",
        event1_title: "Skincare bo'yicha master-klass",
        event1_desc: "Ekspertlarimizdan mukammal parvarish sirlarini o'rganing.",
        event2_title: "Paris To'plami Taqdimoti",
        event2_desc: "Bizning yangi organik liniyamizni birinchilardan bo'lib sinab ko'ring.",
        test1_content: "\"Terim hech qachon bunchalik yorqin ko'rinmagan. Bu mahsulotlar mo'jiza.\"",
        test2_content: "\"Nihoyat, haqiqiy natija beradigan organik kosmetika. Tavsiya qilaman!\"",
        test3_content: "\"Namlik darajasi ajoyib. Yuzim kun bo'yi yumshoq va yangi bo'lib turadi.\"",
        contact_title: "Biz bilan bog'laning",
        contact_subtitle: "Sizdan xabar kutib qolamiz. Bizga yozing.",
        order_success_title: "Buyurtmangiz uchun rahmat!",
        order_success_desc: "Buyurtmangiz qabul qilindi va qayta ishlanmoqda. Tez orada siz bilan bog'lanamiz.",
        order_back_home: "Bosh sahifaga qaytish"
    },
    ru: {
        nav_shop: "ÐœÐ°Ð³Ð°Ð·Ð¸Ð½",
        nav_collections: "ÐšÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸",
        nav_philosophy: "Ð¤Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ",
        nav_about: "Ðž Ð½Ð°Ñ",
        hero_new: "ÐÐ¾Ð²Ð°Ñ ÐšÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ 2026",
        hero_title: "ÐšÑ€Ð°ÑÐ¾Ñ‚Ð° Ð² ÐŸÑ€Ð¾ÑÑ‚Ð¾Ñ‚Ðµ",
        hero_desc: "ÐŸÐ¾Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ Ð¸ÑÑ‚Ð¸Ð½Ð½ÑƒÑŽ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ñ‹ Ñ Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð´ÐµÑ€Ð¼Ð°Ñ‚Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð°Ð¼Ð¸.",
        hero_cta: "ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ð¡ÐµÐ¹Ñ‡Ð°Ñ",
        hero_story: "ÐÐ°ÑˆÐ° Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ",
        hero_feat1: "ÐÐ°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹",
        hero_feat2: "ÐÐµ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð½Ð° Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ñ‹Ñ…",
        hero_feat3: "Ð“Ð»ÑƒÐ±Ð¾ÐºÐ¾Ðµ ÑƒÐ²Ð»Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ",
        shop_title: "Ð¥Ð¸Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°Ð¶",
        shop_subtitle: "ÐÐ°Ñˆ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½",
        shop_all: "Ð’ÑÐµ",
        shop_face: "Ð”Ð»Ñ Ð»Ð¸Ñ†Ð°",
        shop_body: "Ð”Ð»Ñ Ñ‚ÐµÐ»Ð°",
        product_add: "Ð’ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ",
        footer_desc: "ÐœÑ‹ Ð²ÐµÑ€Ð¸Ð¼ Ð² ÑÐ¸Ð»Ñƒ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ñ‹ Ð¸ ÐºÑ€Ð°ÑÐ¾Ñ‚Ñƒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹.",
        footer_discover: "Ð£Ð·Ð½Ð°Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ",
        footer_support: "ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°",
        cart_title: "ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°",
        cart_total: "Ð˜Ñ‚Ð¾Ð³Ð¾:",
        cart_checkout: "ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·",
        auth_register_title: "Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ",
        auth_register_subtitle: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°",
        auth_login_title: "Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼",
        auth_login_subtitle: "Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ²Ð¾Ð¹ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚",
        auth_name: "ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð¸Ð¼Ñ",
        auth_email: "Email Ð°Ð´Ñ€ÐµÑ",
        auth_password: "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ",
        auth_register_btn: "Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ",
        auth_login_btn: "Ð’Ð¾Ð¹Ñ‚Ð¸",
        auth_have_account: "Ð£Ð¶Ðµ ÐµÑÑ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚? ",
        auth_no_account: "ÐÐµÑ‚ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°? ",
        auth_login_link: "Ð’Ð¾Ð¹Ñ‚Ð¸",
        auth_register_link: "Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ",
        checkout_title: "Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸",
        checkout_phone: "ÐÐ¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°",
        checkout_location: "ÐÐ´Ñ€ÐµÑ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸",
        checkout_confirm_btn: "ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·",
        order_summary: "Ð’Ð°Ñˆ Ð·Ð°ÐºÐ°Ð·",
        subtotal: "Ð¡ÑƒÐ¼Ð¼Ð°",
        delivery_fee: "Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ°",
        total: "Ð˜Ñ‚Ð¾Ð³Ð¾",
        delivery_notice: "Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð´Ð»Ñ Ð²ÑÐµÑ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð².",
        events_subtitle: "ÐŸÑ€ÐµÐ´ÑÑ‚Ð¾ÑÑ‰Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ",
        events_title: "ÐŸÐ¾Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÐµÑÑŒ Ð² Ð½Ð°Ñˆ Ð¼Ð¸Ñ€",
        event1_title: "ÐœÐ°ÑÑ‚ÐµÑ€-ÐºÐ»Ð°ÑÑ Ð¿Ð¾ ÑƒÑ…Ð¾Ð´Ñƒ",
        event1_desc: "Ð£Ð·Ð½Ð°Ð¹Ñ‚Ðµ ÑÐµÐºÑ€ÐµÑ‚Ñ‹ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑƒÑ…Ð¾Ð´Ð° Ð¾Ñ‚ Ð½Ð°ÑˆÐ¸Ñ… ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð¾Ð².",
        event2_title: "Ð—Ð°Ð¿ÑƒÑÐº ÐŸÐ°Ñ€Ð¸Ð¶ÑÐºÐ¾Ð¹ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸",
        event2_desc: "Ð‘ÑƒÐ´ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ð¼Ð¸, ÐºÑ‚Ð¾ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÑ‚ Ð½Ð°ÑˆÑƒ Ð½Ð¾Ð²ÑƒÑŽ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð»Ð¸Ð½Ð¸ÑŽ.",
        test1_content: "\"ÐœÐ¾Ñ ÐºÐ¾Ð¶Ð° ÐµÑ‰Ðµ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð±Ñ‹Ð»Ð° Ñ‚Ð°ÐºÐ¾Ð¹ ÑÐ¸ÑÑŽÑ‰ÐµÐ¹. Ð­Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ñ…Ð¾Ð´ÐºÐ°.\"",
        test2_content: "\"ÐÐ°ÐºÐ¾Ð½ÐµÑ†-Ñ‚Ð¾ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑƒÑ…Ð¾Ð´, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚. Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÑŽ!\"",
        test3_content: "\"ÐÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾Ðµ ÑƒÐ²Ð»Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ. ÐœÐ¾Ðµ Ð»Ð¸Ñ†Ð¾ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¼ÑÐ³ÐºÐ¸Ð¼ Ð¸ ÑÐ²ÐµÐ¶Ð¸Ð¼ Ð²ÐµÑÑŒ Ð´ÐµÐ½ÑŒ.\"",
        contact_title: "Ð¡Ð²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð½Ð°Ð¼Ð¸",
        contact_subtitle: "ÐœÑ‹ Ð±ÑƒÐ´ÐµÐ¼ Ñ€Ð°Ð´Ñ‹ ÑƒÑÐ»Ñ‹ÑˆÐ°Ñ‚ÑŒ Ð²Ð°Ñ. ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð½Ð°Ð¼.",
        order_success_title: "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð²Ð°Ñˆ Ð·Ð°ÐºÐ°Ð·!",
        order_success_desc: "Ð’Ð°Ñˆ Ð·Ð°ÐºÐ°Ð· Ð¿Ñ€Ð¸Ð½ÑÑ‚ Ð¸ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ. ÐœÑ‹ ÑÐ²ÑÐ¶ÐµÐ¼ÑÑ Ñ Ð²Ð°Ð¼Ð¸ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ.",
        order_back_home: "ÐÐ° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ"
    }
};

const CONFIG = { deliveryFee: 5.00 };
let isLoginMode = false;
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let users = JSON.parse(localStorage.getItem('users')) || [];

function setLanguage(lang) {
    localStorage.setItem('selectedLanguage', lang);
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });
    document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-lang') === lang));
    document.documentElement.lang = lang;
    if (window.location.pathname.includes('checkout.html')) renderOrderSummary();
}

function handleAuth(e) {
    e.preventDefault();
    const name = document.getElementById('auth-name').value;
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;

    if (isLoginMode) {
        const user = users.find(u => u.email === email && u.password === password);
        if (user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
            localStorage.setItem('isLoggedIn', 'true');
            hideAuth();
        } else { alert('Invalid credentials'); }
    } else {
        const newUser = { name, email, password };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.setItem('currentUser', JSON.stringify(newUser));
        localStorage.setItem('isLoggedIn', 'true');
        hideAuth();
    }
}

function hideAuth() {
    const overlay = document.getElementById('auth-overlay');
    if (overlay) overlay.style.display = 'none';
    document.body.classList.remove('auth-locked');
}

function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    const lang = localStorage.getItem('selectedLanguage') || 'en';
    const title = document.getElementById('auth-title');
    const subtitle = document.getElementById('auth-subtitle');
    const nameGroup = document.getElementById('name-group');
    const submitBtn = document.getElementById('auth-submit');
    const switchText = document.getElementById('auth-switch-text');

    if (isLoginMode) {
        title.textContent = translations[lang].auth_login_title;
        subtitle.textContent = translations[lang].auth_login_subtitle;
        nameGroup.style.display = 'none';
        submitBtn.textContent = translations[lang].auth_login_btn;
        switchText.innerHTML = `${translations[lang].auth_no_account} <a href="#" id="auth-switch">${translations[lang].auth_register_link}</a>`;
    } else {
        title.textContent = translations[lang].auth_register_title;
        subtitle.textContent = translations[lang].auth_register_subtitle;
        nameGroup.style.display = 'block';
        submitBtn.textContent = translations[lang].auth_register_btn;
        switchText.innerHTML = `${translations[lang].auth_have_account} <a href="#" id="auth-switch">${translations[lang].auth_login_link}</a>`;
    }
    document.getElementById('auth-switch').addEventListener('click', (e) => { e.preventDefault(); toggleAuthMode(); });
}

function calculateOrderTotal() {
    let subtotal = 0;
    cart.forEach(item => subtotal += parseFloat(item.price) * item.quantity);
    return { subtotal, delivery: CONFIG.deliveryFee, total: subtotal + CONFIG.deliveryFee };
}

function renderOrderSummary() {
    const list = document.getElementById('summary-items-list');
    const subtotalEl = document.getElementById('subtotal-val');
    const deliveryEl = document.getElementById('delivery-fee-val');
    const totalEl = document.getElementById('total-val');
    if (!list) return;
    list.innerHTML = '';
    const calc = calculateOrderTotal();
    cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'summary-item';
        div.innerHTML = `<span>${item.name} x ${item.quantity}</span> <span>$${(item.price * item.quantity).toFixed(2)}</span>`;
        list.appendChild(div);
    });
    subtotalEl.textContent = `$${calc.subtotal.toFixed(2)}`;
    deliveryEl.textContent = `$${calc.delivery.toFixed(2)}`;
    totalEl.textContent = `$${calc.total.toFixed(2)}`;
}

function updateCartUI() {
    const cartContainer = document.querySelector('.cart-items');
    const cartCount = document.querySelector('.cart-count');
    const totalAmount = document.querySelector('.total-amount');
    if (!cartContainer) return;
    cartContainer.innerHTML = '';
    let total = 0, count = 0;
    cart.forEach((item, index) => {
        total += parseFloat(item.price) * item.quantity;
        count += item.quantity;
        const itemEl = document.createElement('div');
        itemEl.className = 'cart-item';
        itemEl.innerHTML = `<div class="cart-item-info"><h5>${item.name}</h5><span>${item.quantity} x $${item.price}</span></div><button class="remove-item" onclick="removeFromCart(${index})">Remove</button>`;
        cartContainer.appendChild(itemEl);
    });
    if (cartCount) cartCount.textContent = count;
    if (totalAmount) totalAmount.textContent = `$${total.toFixed(2)}`;
    localStorage.setItem('cart', JSON.stringify(cart));
}

function addToCart(id, name, price) {
    const existingItem = cart.find(item => item.id === id);
    if (existingItem) existingItem.quantity += 1;
    else cart.push({ id, name, price, quantity: 1 });
    updateCartUI();
    document.querySelector('.cart-dropdown').classList.add('active');
}

window.removeFromCart = function(index) {
    cart.splice(index, 1);
    updateCartUI();
};

document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('isLoggedIn') === 'true') hideAuth();
    const savedLang = localStorage.getItem('selectedLanguage') || 'en';
    setLanguage(savedLang);

    const authForm = document.getElementById('auth-form');
    if (authForm) authForm.addEventListener('submit', handleAuth);
    const authSwitch = document.getElementById('auth-switch');
    if (authSwitch) authSwitch.addEventListener('click', (e) => { e.preventDefault(); toggleAuthMode(); });

    document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', () => setLanguage(btn.getAttribute('data-lang'))));

    const cartToggle = document.querySelector('.cart-toggle');
    const cartDropdown = document.querySelector('.cart-dropdown');
    if (cartToggle) cartToggle.addEventListener('click', (e) => { e.stopPropagation(); cartDropdown.classList.toggle('active'); });

    document.querySelectorAll('.quick-add').forEach(btn => btn.addEventListener('click', (e) => {
        const card = e.target.closest('.product-card');
        addToCart(card.getAttribute('data-id'), card.getAttribute('data-name'), card.getAttribute('data-price'));
    }));

    const checkoutBtn = document.querySelector('[data-i18n="cart_checkout"]');
    if (checkoutBtn) {
        checkoutBtn.addEventListener('click', () => {
            if (cart.length > 0) window.location.href = 'checkout.html';
            else alert('Your cart is empty');
        });
    }

    const filterBtns = document.querySelectorAll('.filter-btn');
    const productCards = document.querySelectorAll('.product-card');
    filterBtns.forEach(btn => btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.getAttribute('data-filter');
        productCards.forEach(card => card.style.display = (filter === 'all' || card.getAttribute('data-category') === filter) ? 'block' : 'none');
    }));

    const orderForm = document.getElementById('order-form');
    if (orderForm) {
        orderForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const phone = document.getElementById('order-phone').value;
            const location = document.getElementById('order-location').value;
            const orderData = { items: cart, customer: JSON.parse(localStorage.getItem('currentUser')), phone, location, total: calculateOrderTotal().total, date: new Date().toISOString() };
            console.log('Order Placed:', orderData);
            
            const container = document.querySelector('.checkout-container');
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 100px 0;">
                    <div style="font-size: 80px; margin-bottom: 20px;">ðŸ“¦</div>
                    <h1 data-i18n="order_success_title">${translations[savedLang].order_success_title}</h1>
                    <p data-i18n="order_success_desc" style="color: var(--muted); margin: 20px 0 40px;">${translations[savedLang].order_success_desc}</p>
                    <a href="index.html" class="btn btn-primary" data-i18n="order_back_home">${translations[savedLang].order_back_home}</a>
                </div>
            `;
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
        });
    }

    updateCartUI();
});
